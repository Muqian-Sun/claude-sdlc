# SDLC 六阶段详细定义

所有阶段必须顺序执行，禁止跳过。每个阶段审查通过是推进的必要条件。严格按 PRD 开发。

---

## P1 — 需求分析

### 阶段活动
- **检查 `project_roadmap` 和 `completed_tasks`** — 了解长期规划和已完成的工作，确保新任务与整体规划一致
- 理解用户需求，逐条澄清，消除模糊点
- 分析现有代码库（Read, Glob, Grep），参考 `global_architecture` 中的全局架构决策
- 识别技术约束、依赖关系和影响范围
- 搜索相关文档和最佳实践（WebSearch, WebFetch）
- **整理编号化 PRD 需求清单，提交给用户确认**
- 如用户提供了多阶段计划，写入 `project_roadmap`

### 必需产出物
- PRD（每条需求有编号 R1/R2...、验收标准、范围排除项）
- 技术可行性评估 + 影响范围分析

### PRD 确认流程
1. 向用户展示完整 PRD → 用户确认 → 写入 project-state.md 的 `prd` 字段
2. PRD 写入即锁定，后续阶段以此为唯一依据
3. 如需修改 → 回 P1 重新获用户确认

### 审查清单（`/review`）
- [ ] 需求完整（覆盖用户所有需求点）、明确（有编号+验收标准）、一致（无矛盾）
- [ ] 范围边界明确（列出不做的事项）
- [ ] 技术可行 + 影响分析完整
- [ ] **用户已确认 + PRD 已写入 project-state.md**

### 允许工具
✅ Read, Glob, Grep, WebSearch, WebFetch ❌ Write, Edit, Bash

---

## P2 — 系统设计

**需用户确认** — 确认后自动审查推进到 P3 并启动自动驱动。

### 阶段活动
- **【必须首先执行】最新技术调研**：Context7 MCP 查询最新文档 + WebSearch 搜索最流行架构方案
- **【涉及 UI 时必须执行】现代 UI 设计调研**：
  1. WebSearch 搜索 `"{框架名} modern UI design {当前年份}"` `"best {框架名} UI component library {当前年份}"` `"UI design trends {当前年份}"`
  2. 调研主流 UI 组件库（如 shadcn/ui、Radix、Ant Design 5、Material Design 3、Tailwind UI 等）的最新设计语言
  3. 参考成功产品的 UI 设计模式（圆角、渐变、玻璃态、微动画、暗色模式等现代元素）
  4. 确定配色方案、字体层级、间距系统、响应式断点
  5. **禁止使用过时/简陋的 UI 风格**（如无样式 HTML、Bootstrap 3 默认主题、90 年代表格布局）
- 逐条对照 PRD 设计架构方案
- 确定技术选型（基于最新文档，非过时记忆）
- 原型设计（如涉及 UI）：页面布局、组件结构、交互流程、视觉风格、动效方案
- 设计数据模型和接口，制定文件修改计划
- **为每条 PRD 需求标注对应的设计模块**

### 必需产出物
- 技术调研记录 + 架构设计方案（引用最新文档）
- PRD→设计映射表 + 文件修改清单
- **UI 设计方案**（如涉及 UI）：组件库选型 + 配色方案 + 布局结构 + 交互细节 + 参考来源链接
- 实现步骤分解

### 审查清单（`/review`）
- [ ] **最新文档已查阅**（Context7 + WebSearch）
- [ ] **PRD 全覆盖**（逐条对照）+ **无超出 PRD 的设计**
- [ ] 架构合理（符合社区最佳实践，无过度设计）
- [ ] **UI 现代化**（如涉及 UI）— 使用当前主流组件库/设计语言，有参考来源，无过时风格
- [ ] 接口清晰 + 错误处理已考虑 + 可测试
- [ ] 技术选型有据（引用最新文档）

### 允许工具
✅ Read, Glob, Grep, WebSearch, WebFetch, Context7 MCP, Chrome ❌ Write, Edit, Bash

---

## P3 — 编码实现

**自动驱动** — 完成后自动审查，通过自动进入 P4。

### 阶段活动
- **【编码前必须】**Context7 MCP 查最新 API + WebSearch 查最新实现模式
- 严格按 P2 设计编码，不添加 PRD 外功能
- 遵循编码规范（见 02-coding-standards.md）
- 每完成一个逻辑单元更新 modified_files
- 有独立模块时可用 Task 并行派发 `sdlc-coder` Agent

### 禁止行为
- ❌ 实现 PRD 未列出的功能 / 添加"顺手"优化
- ❌ 跳过任何 PRD 需求 / 自行替换用户确认的方案
- 发现 PRD 遗漏 → 停止编码，回 P1/P2 确认

### 审查清单（`/review`）
- [ ] **最新 API** — 无已废弃调用
- [ ] **PRD 全实现** — 逐条对照 + **无 PRD 外代码**
- [ ] **Lint 通过** 0 error + **类型检查通过**（如适用）+ **构建成功** + **依赖安全**无 high/critical
- [ ] 设计符合性 — 与 P2 方案一致
- [ ] 代码质量 — 按 02-coding-standards.md 检查（命名、函数≤50行、嵌套≤3层、错误处理、安全性）

### 允许工具
✅ Read, Glob, Grep, Write, Edit, Bash（非测试非git）, Context7 MCP, WebSearch ❌ Bash 测试命令

---

## P4 — 测试验证

**自动驱动** — 测试全通过后自动审查推进到 P5。

### 阶段活动
- 按 PRD 需求编写测试（每条至少一个测试用例）
- 执行测试并分析结果（遵循测试效率规则）
- 修复 bug（仅 PRD 范围内）
- 有独立模块时可并行派发 `sdlc-tester` Agent

### 必需产出物
- 测试用例代码 + PRD→测试映射表
- 测试执行结果（全部通过）+ 覆盖率报告

### 审查清单（`/review`）
- [ ] **每条 PRD 需求有对应测试**
- [ ] **测试全部通过** 0 failure
- [ ] **覆盖率**：行 ≥80%、关键业务 ≥90%、分支 ≥70%
- [ ] 测试质量 — AAA 模式、命名清晰、独立、mock 合理
- [ ] 回归保护 — 已有测试仍通过

### 允许工具
✅ Read, Glob, Grep, Write, Edit, Bash（含测试）, Chrome

---

## P5 — 集成审查

**自动驱动** — 通过后自动进入 P6。发现问题回退 P3/P4 修复。

侧重**跨文件/跨模块的全局视角**，单阶段审查无法发现的系统级问题。

### 必需产出物
- 集成审查报告
- **PRD 完整追溯表**（每条需求 → 设计 → 代码文件:行号 → 测试）

### 审查清单（`/review`）
- [ ] **PRD 四环追溯** — 需求→设计→代码→测试，无断链
- [ ] **无 PRD 外变更**
- [ ] 全局一致性（接口、数据模型、错误处理策略一致）
- [ ] 集成安全性（信任边界、权限检查、敏感信息传递）
- [ ] 性能（无 N+1、无重复 I/O）+ 无遗漏 TODO/FIXME

### 允许工具
✅ Read, Glob, Grep ⚠️ Write/Edit（仅修复审查问题，修复后需重验证）

---

## P6 — 部署交付

**自动完成** — 交付审查通过后输出摘要报告。

### 阶段活动
- git add/commit/push + 创建 PR + 更新文档

### 审查清单（`/review`）
- [ ] Commit 符合 Conventional Commits + 粒度合理
- [ ] 无敏感信息提交 + PR 描述完整
- [ ] 文档按需更新

### 允许工具
✅ Read, Glob, Grep, Bash（git/deploy） ⚠️ Write/Edit（仅文档）
