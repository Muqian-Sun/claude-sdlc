# SDLC 六阶段详细定义

本规则定义软件开发生命周期（SDLC）六个阶段的详细要求。**所有阶段必须顺序执行，禁止跳过。**

**核心原则：每个阶段都有对应的审查（Review），审查通过是阶段推进的必要条件。错误越早发现修复成本越低。**

---

## P1 — 需求分析

### 入口条件
- 用户提出了明确的开发任务或需求

### 阶段活动
- 理解用户需求，澄清模糊点
- 分析现有代码库（Read, Glob, Grep）
- 识别技术约束和依赖关系
- 确定功能范围和边界
- 搜索相关文档和最佳实践（WebSearch, WebFetch）

### 必需产出物
- [ ] 需求清单（功能需求 + 非功能需求）
- [ ] 技术可行性评估
- [ ] 影响范围分析（受影响的文件和模块）
- [ ] 风险识别

### 阶段审查（需求审查）
推进前必须通过 `/review` 需求审查：
- [ ] 需求完整性 — 覆盖用户所有需求点
- [ ] 需求明确性 — 无歧义表述，有验收标准
- [ ] 需求一致性 — 需求间无矛盾
- [ ] 技术可行性 — 在当前技术栈下可实现
- [ ] 范围边界 — 明确做什么、不做什么
- [ ] 影响分析 — 受影响的文件和模块已识别

### 退出条件
- 用户确认需求理解正确
- 需求清单已整理完成
- 影响范围已明确
- **需求审查已通过**（`/review`）

### 允许的工具
- ✅ Read, Glob, Grep（代码分析）
- ✅ WebSearch, WebFetch（资料查询）
- ❌ Write, Edit（禁止修改代码文件）
- ❌ Bash 测试命令（禁止执行测试）

---

## P2 — 系统设计

### 入口条件
- P1 需求分析已完成（含需求审查通过）
- 需求清单已获用户确认

### 阶段活动
- 设计系统架构方案
- 确定技术选型
- 设计数据模型和接口
- 制定文件/模块修改计划
- 评估多种实现方案的优劣

### 必需产出物
- [ ] 架构设计方案（含理由说明）
- [ ] 文件修改清单（预计新增/修改/删除的文件）
- [ ] 接口设计（如涉及 API）
- [ ] 实现步骤分解

### 阶段审查（设计审查）
推进前必须通过 `/review` 设计审查：
- [ ] 架构合理性 — 方案合理，无过度设计
- [ ] 与现有架构一致性 — 符合项目已有风格
- [ ] 需求覆盖 — 设计覆盖 P1 所有需求
- [ ] 接口设计 — API/函数接口清晰、参数合理
- [ ] 错误处理策略 — 异常和边界情况已考虑
- [ ] 技术选型依据 — 有充分理由，评估了替代方案
- [ ] 可测试性 — 设计便于编写测试

### 退出条件
- 架构方案已获用户确认
- 实现步骤已明确
- 技术选型已确定
- **设计审查已通过**（`/review`）

### 允许的工具
- ✅ Read, Glob, Grep（代码分析）
- ✅ WebSearch, WebFetch（技术调研）
- ❌ Write, Edit（禁止修改代码文件）
- ❌ Bash 测试命令（禁止执行测试）

---

## P3 — 编码实现

### 入口条件
- P2 系统设计已完成（含设计审查通过）
- 架构方案已获用户确认
- 实现步骤已明确

### 阶段活动
- 按设计方案编写代码
- 遵循编码规范（见 02-coding-standards.md）
- 每完成一个逻辑单元，更新 CLAUDE.md 中的 modified_files
- 记录实现中的关键决策

### 必需产出物
- [ ] 功能代码实现
- [ ] 代码符合编码规范
- [ ] CLAUDE.md 中 modified_files 已更新
- [ ] 关键实现决策已记录

### 阶段审查（代码审查）
推进前必须通过 `/review` 代码审查：
- [ ] 设计符合性 — 实现与 P2 设计方案一致
- [ ] 代码质量 — 命名、函数设计、格式规范
- [ ] 安全性 — 无注入、XSS、敏感信息泄露等风险
- [ ] 可维护性 — 可读、有必要注释、模块职责清晰

### 退出条件
- 所有计划的代码修改已完成
- 代码通过基本语法检查
- 无明显的编码规范违规
- **代码审查已通过**（`/review`）

### 允许的工具
- ✅ Read, Glob, Grep（代码分析）
- ✅ Write, Edit（代码编写）
- ✅ Bash（编译/构建/lint，但不执行测试）
- ❌ Bash 测试命令（禁止执行测试）

---

## P4 — 测试验证

### 入口条件
- P3 编码实现已完成（含代码审查通过）
- 所有计划代码已编写

### 阶段活动
- 编写测试用例（遵循 03-testing-standards.md）
- 执行测试并分析结果
- 修复发现的 bug
- 确保测试覆盖率达标

### 必需产出物
- [ ] 测试用例代码
- [ ] 测试执行结果（全部通过）
- [ ] Bug 修复记录（如有）
- [ ] 测试覆盖率报告（如工具支持）

### 阶段审查（测试审查）
推进前必须通过 `/review` 测试审查：
- [ ] 测试覆盖度 — 新增/修改的公共函数均有测试，正常/错误/边界路径已覆盖
- [ ] 测试质量 — 遵循 AAA 模式，命名清晰，测试独立
- [ ] 测试结果 — 全部通过，无跳过
- [ ] 回归保护 — 已有测试仍通过

### 退出条件
- 所有测试用例通过
- 关键路径覆盖率 ≥ 80%
- 无已知未修复的 bug
- **测试审查已通过**（`/review`）

### 允许的工具
- ✅ Read, Glob, Grep（代码分析）
- ✅ Write, Edit（编写测试 / 修复 bug）
- ✅ Bash（执行测试、构建、lint）

---

## P5 — 集成审查

### 入口条件
- P4 测试验证已完成（含测试审查通过）
- 所有测试通过

### 阶段活动
- 跨模块全局一致性检查
- 集成安全性审查
- 性能全局视角检查
- 需求→设计→代码→测试的完整性追溯
- 记录审查发现

### 说明
P5 不再是唯一的 review 阶段。P1-P4 的阶段审查已在各阶段内完成，P5 侧重于**跨文件/跨模块的全局视角**，检查单个阶段审查无法发现的系统级问题。

### 必需产出物
- [ ] 集成审查报告（全局一致性、集成安全、性能、变更完整性）
- [ ] 需求覆盖追溯表（每条需求 → 对应代码 → 对应测试）
- [ ] 问题修复确认（如有需修复项，回退到 P3/P4）

### 阶段审查（集成审查）
推进前必须通过 `/review` 集成审查：
- [ ] 全局一致性 — 模块间接口、数据模型、错误处理策略一致
- [ ] 集成安全性 — 信任边界、权限检查、敏感信息传递安全
- [ ] 性能全局视角 — 无 N+1、无重复 I/O、热路径可接受
- [ ] 变更完整性 — P1 需求全部实现，P2 设计全部落地，无遗漏 TODO

### 退出条件
- 集成审查报告已生成
- 所有严重/高优先级问题已修复
- 需求覆盖追溯完整
- 用户确认审查通过
- **集成审查已通过**（`/review`）

### 允许的工具
- ✅ Read, Glob, Grep（代码审查）
- ⚠️ Write, Edit（仅在修复审查问题时允许，修复后需重回 P4 验证）

---

## P6 — 部署交付

### 入口条件
- P5 集成审查已通过
- 所有审查问题已解决

### 阶段活动
- 执行 git 操作（add, commit, push）
- 创建 PR（如需要）
- 更新文档（如需要）
- 清理临时文件

### 必需产出物
- [ ] Git commit（符合 Conventional Commits 规范）
- [ ] PR（如适用）
- [ ] 更新后的文档（如适用）

### 阶段审查（交付审查）
交付前必须通过 `/review` 交付审查：
- [ ] Commit 规范 — 符合 Conventional Commits，粒度合理
- [ ] 无敏感信息 — 无 .env、密钥、token 被提交
- [ ] PR 描述 — Summary/Changes/Test Plan 完整
- [ ] 文档更新 — README/CHANGELOG 按需更新

### 退出条件
- 代码已提交
- PR 已创建（如适用）
- 用户确认交付完成
- **交付审查已通过**（`/review`）

### 允许的工具
- ✅ Read, Glob, Grep
- ✅ Bash（git 操作、部署命令）
- ⚠️ Write, Edit（仅用于文档更新）

---

## 审查总览

| 阶段 | 审查类型 | 审查重点 | 未通过处理 |
|------|---------|---------|-----------|
| P1 | 需求审查 | 完整性、明确性、可行性 | 补充需求后重新审查 |
| P2 | 设计审查 | 架构合理性、需求覆盖、可测试性 | 修改设计后重新审查 |
| P3 | 代码审查 | 设计符合性、代码质量、安全性 | 修改代码后重新审查 |
| P4 | 测试审查 | 覆盖度、测试质量、全部通过 | 补充测试后重新审查 |
| P5 | 集成审查 | 全局一致性、集成安全、变更完整性 | 回退 P3/P4 修复后重新审查 |
| P6 | 交付审查 | Commit 规范、无敏感信息、文档 | 修正后重新审查 |
