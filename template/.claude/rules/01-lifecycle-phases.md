# SDLC 六阶段详细定义

本规则定义软件开发生命周期（SDLC）六个阶段的详细要求。**所有阶段必须顺序执行，禁止跳过。**

---

## P1 — 需求分析

### 入口条件
- 用户提出了明确的开发任务或需求

### 阶段活动
- 理解用户需求，澄清模糊点
- 分析现有代码库（Read, Glob, Grep）
- 识别技术约束和依赖关系
- 确定功能范围和边界
- 搜索相关文档和最佳实践（WebSearch, WebFetch）

### 必需产出物
- [ ] 需求清单（功能需求 + 非功能需求）
- [ ] 技术可行性评估
- [ ] 影响范围分析（受影响的文件和模块）
- [ ] 风险识别

### 退出条件
- 用户确认需求理解正确
- 需求清单已整理完成
- 影响范围已明确

### 允许的工具
- ✅ Read, Glob, Grep（代码分析）
- ✅ WebSearch, WebFetch（资料查询）
- ❌ Write, Edit（禁止修改代码文件）
- ❌ Bash 测试命令（禁止执行测试）

---

## P2 — 系统设计

### 入口条件
- P1 需求分析已完成
- 需求清单已获用户确认

### 阶段活动
- 设计系统架构方案
- 确定技术选型
- 设计数据模型和接口
- 制定文件/模块修改计划
- 评估多种实现方案的优劣

### 必需产出物
- [ ] 架构设计方案（含理由说明）
- [ ] 文件修改清单（预计新增/修改/删除的文件）
- [ ] 接口设计（如涉及 API）
- [ ] 实现步骤分解

### 退出条件
- 架构方案已获用户确认
- 实现步骤已明确
- 技术选型已确定

### 允许的工具
- ✅ Read, Glob, Grep（代码分析）
- ✅ WebSearch, WebFetch（技术调研）
- ❌ Write, Edit（禁止修改代码文件）
- ❌ Bash 测试命令（禁止执行测试）

---

## P3 — 编码实现

### 入口条件
- P2 系统设计已完成
- 架构方案已获用户确认
- 实现步骤已明确

### 阶段活动
- 按设计方案编写代码
- 遵循编码规范（见 02-coding-standards.md）
- 每完成一个逻辑单元，更新 CLAUDE.md 中的 modified_files
- 记录实现中的关键决策

### 必需产出物
- [ ] 功能代码实现
- [ ] 代码符合编码规范
- [ ] CLAUDE.md 中 modified_files 已更新
- [ ] 关键实现决策已记录

### 退出条件
- 所有计划的代码修改已完成
- 代码通过基本语法检查
- 无明显的编码规范违规

### 允许的工具
- ✅ Read, Glob, Grep（代码分析）
- ✅ Write, Edit（代码编写）
- ✅ Bash（编译/构建/lint，但不执行测试）
- ❌ Bash 测试命令（禁止执行测试）

---

## P4 — 测试验证

### 入口条件
- P3 编码实现已完成
- 所有计划代码已编写

### 阶段活动
- 编写测试用例（遵循 03-testing-standards.md）
- 执行测试并分析结果
- 修复发现的 bug
- 确保测试覆盖率达标

### 必需产出物
- [ ] 测试用例代码
- [ ] 测试执行结果（全部通过）
- [ ] Bug 修复记录（如有）
- [ ] 测试覆盖率报告（如工具支持）

### 退出条件
- 所有测试用例通过
- 关键路径覆盖率 ≥ 80%
- 无已知未修复的 bug

### 允许的工具
- ✅ Read, Glob, Grep（代码分析）
- ✅ Write, Edit（编写测试 / 修复 bug）
- ✅ Bash（执行测试、构建、lint）

---

## P5 — 代码审查

### 入口条件
- P4 测试验证已完成
- 所有测试通过

### 阶段活动
- 审查代码质量（见 /review 命令）
- 检查安全隐患
- 验证性能考虑
- 确认可维护性
- 记录审查发现

### 必需产出物
- [ ] 代码审查报告（四维度：质量、安全、性能、可维护性）
- [ ] 审查发现的问题清单
- [ ] 问题修复确认（如有需修复项，回退到 P3/P4）

### 退出条件
- 审查报告已生成
- 所有严重/高优先级问题已修复
- 用户确认审查通过

### 允许的工具
- ✅ Read, Glob, Grep（代码审查）
- ⚠️ Write, Edit（仅在修复审查问题时允许，修复后需重回 P4 验证）

---

## P6 — 部署交付

### 入口条件
- P5 代码审查已通过
- 所有审查问题已解决

### 阶段活动
- 执行 git 操作（add, commit, push）
- 创建 PR（如需要）
- 更新文档（如需要）
- 清理临时文件

### 必需产出物
- [ ] Git commit（符合 Conventional Commits 规范）
- [ ] PR（如适用）
- [ ] 更新后的文档（如适用）

### 退出条件
- 代码已提交
- PR 已创建（如适用）
- 用户确认交付完成

### 允许的工具
- ✅ Read, Glob, Grep
- ✅ Bash（git 操作、部署命令）
- ⚠️ Write, Edit（仅用于文档更新）
