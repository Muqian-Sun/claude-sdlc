---
paths:
  - "**/*.test.*"
  - "**/*.spec.*"
  - "**/test_*"
  - "**/*_test.*"
  - "**/tests/**"
  - "**/__tests__/**"
---

# 测试标准

## PRD 驱动测试（最高优先级）

测试必须以 PRD 为依据，每条 PRD 需求至少对应一个测试用例。

1. P3 开始时先列出 PRD→测试映射表（R1→test_xxx, R2→test_yyy...）
2. 逐条覆盖，确保无遗漏
3. 不为 PRD 范围外的代码编写测试（有 PRD 外代码应回退 P2 删除）
4. 验收标准以 PRD 中定义的为准

---

## P3 测试类型

| 测试类型 | 要求 | 说明 |
|---------|------|------|
| 单元测试 | 必须 | 覆盖所有新增/修改的公共函数 |
| 边界测试 | 必须 | 空值、极值、边界条件 |
| 错误路径测试 | 必须 | 异常输入、错误处理分支 |
| 集成测试 | 视情况 | 涉及多模块交互时 |
| E2E 测试 | 视情况 | 涉及用户交互流程时 |

---

## 覆盖率要求

| 指标 | 目标 |
|------|------|
| 新增代码行覆盖率 | ≥ 80% |
| 关键业务逻辑覆盖率 | ≥ 90% |
| 分支覆盖率 | ≥ 70% |

---

## 测试执行效率规则

**测试命令只运行一次，从输出文件分析结果。禁止反复运行同一测试。**

1. 运行一次，`tee /tmp/sdlc-test-output.txt` 保存输出
2. Read 读取输出文件分析所有结果
3. 如有失败 → 一次性收集所有错误 → **批量修复** → 再跑一次验证
4. **整个 P3 最多运行 3 次测试命令**
5. 禁止：反复执行同一测试、`-t "name"` 单跑、每修一个跑一次
