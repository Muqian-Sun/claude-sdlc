---
paths:
  - "**/*.js"
  - "**/*.ts"
  - "**/*.jsx"
  - "**/*.tsx"
  - "**/*.py"
  - "**/*.go"
  - "**/*.rs"
  - "**/*.java"
  - "**/*.c"
  - "**/*.cpp"
  - "**/*.h"
  - "**/*.cs"
  - "**/*.rb"
  - "**/*.php"
  - "**/*.swift"
  - "**/*.kt"
  - "**/*.dart"
  - "**/*.vue"
  - "**/*.svelte"
---

# 编码规范

## PRD 约束（最高优先级）

每写一个函数/类/模块时，必须能回答"这对应 PRD 中的哪条需求？"

- **禁止添加**：PRD 未列出的功能、接口、参数、配置项、优化
- **禁止减少**：不得跳过或简化 PRD 中任何一条需求
- **禁止"顺手"改进**：不得借编码之机重构无关代码、添加额外文档、优化未要求的性能

> 发现 PRD 遗漏 → **停止编码，回退到 P1 与用户确认**。

---

## 硬性指标

| 指标 | 限制 |
|------|------|
| 函数体行数 | ≤ 50 行（不含注释和空行） |
| 嵌套层级 | ≤ 3 层 |
| 函数参数 | ≤ 4 个，超过用对象/结构体 |
| 单一职责 | 函数名需要用 "and" 连接 → 拆分 |

---

## 安全规范（OWASP 重点）

| 风险 | 防御 |
|------|------|
| SQL 注入 | 参数化查询，禁止拼接 |
| XSS | 用户输入 HTML 转义 |
| 目录遍历 | 文件路径操作需验证 |
| 硬编码密钥 | 禁止。使用环境变量或密钥管理 |
| 日志泄露 | 日志中不记录敏感信息 |

---

## P2 完成检查清单

- [ ] **PRD 符合性** — 所有代码都能对应到 PRD 某条需求
- [ ] 函数≤50行、嵌套≤3层、单一职责
- [ ] 无安全隐患（注入、XSS、敏感信息泄露）
- [ ] 无硬编码的魔法数字/字符串
