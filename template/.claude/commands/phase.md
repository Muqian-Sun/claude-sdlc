# /phase — SDLC 阶段管理

用法：`/phase [next|back|status]`

参数：$ARGUMENTS

---

## 执行逻辑

根据参数执行以下操作：

### 无参数 或 `status`
1. 读取 CLAUDE.md 中的 `current_phase` 值
2. 输出当前阶段信息：
   - 阶段编号和名称
   - 该阶段允许的操作
   - 该阶段的退出条件
   - 当前已完成的退出条件项
3. 提示用户可用的操作（next/back）

### `next` — 推进到下一阶段
1. 读取当前阶段
2. 根据 `01-lifecycle-phases.md` 中定义的退出条件，逐项检查：
   - ✅ 已满足的条件
   - ❌ 未满足的条件
3. **如果所有退出条件已满足**：
   - 将 `current_phase` 更新为下一阶段（例如 P1 → P2）
   - 更新 `phase_history` 记录
   - 更新 `last_updated` 时间戳
   - 输出新阶段的入口信息和活动指南
4. **如果有未满足的退出条件**：
   - 列出所有未满足项
   - 提供完成建议
   - 不推进阶段
   - 询问用户是否要强制推进（记录跳过的条件）

### `back` — 回退到上一阶段
1. 读取当前阶段
2. 如果已是 P0/P1，提示无法继续回退
3. 要求提供回退原因
4. 更新 `current_phase` 为上一阶段
5. 更新 `phase_history` 记录（含回退原因）
6. 更新 `last_updated` 时间戳
7. 输出回退后的阶段信息

---

## 阶段速查表

| 阶段 | 名称 | 核心活动 |
|------|------|---------|
| P0 | 未开始 | 等待任务 |
| P1 | 需求分析 | 理解需求、分析代码库、识别范围 |
| P2 | 系统设计 | 架构设计、技术选型、实现计划 |
| P3 | 编码实现 | 编写代码、遵循规范 |
| P4 | 测试验证 | 编写测试、执行测试、修复 bug |
| P5 | 代码审查 | 质量/安全/性能/可维护性审查 |
| P6 | 部署交付 | Git 提交、创建 PR、文档更新 |

---

## 重要提醒

- 更新 CLAUDE.md 中的 `current_phase` 后，工具使用限制会相应变化
- Hooks 会根据 CLAUDE.md 中的阶段值进行运行时拦截
- 阶段推进是不可撤销的决策，请谨慎操作
- 如果用户强制跳过退出条件，在 `phase_history` 中记录跳过的条件
