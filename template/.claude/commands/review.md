# /review — 代码审查

用法：`/review [文件路径]`

参数：$ARGUMENTS

---

## 执行逻辑

### 前置检查
1. 确认当前阶段为 P5（代码审查）或更高
2. 如果当前阶段低于 P5，提醒用户：
   ```
   ⚠️ 代码审查应在 P5 阶段执行。当前阶段：{阶段}
   建议先完成前置阶段后再执行审查。是否仍要继续？
   ```

### 确定审查范围
- **如果指定了文件路径**：审查指定文件
- **如果未指定文件**：审查 CLAUDE.md 中 `modified_files` 列表里的所有文件

### 四维度审查

对每个文件执行以下四个维度的审查：

#### 1. 代码质量 (Quality)
- [ ] 命名清晰、符合语言约定
- [ ] 函数单一职责、长度合理（≤50 行）
- [ ] 嵌套层级合理（≤3 层）
- [ ] 无魔法数字/字符串
- [ ] 无冗余代码或注释掉的代码
- [ ] 导入语句已清理
- [ ] 错误处理完善
- [ ] 代码格式一致

#### 2. 安全性 (Security)
- [ ] 无 SQL 注入风险
- [ ] 无 XSS 风险
- [ ] 无命令注入风险
- [ ] 无目录遍历风险
- [ ] 无硬编码的敏感信息（密码、密钥、token）
- [ ] 输入验证充分
- [ ] 依赖包安全

#### 3. 性能 (Performance)
- [ ] 无不必要的循环或递归
- [ ] 无 N+1 查询问题
- [ ] 大数据集操作有分页/流处理
- [ ] 无内存泄漏风险
- [ ] 缓存策略合理（如适用）

#### 4. 可维护性 (Maintainability)
- [ ] 代码可读性好
- [ ] 复杂逻辑有注释说明
- [ ] 公共 API 有文档注释
- [ ] 模块职责清晰
- [ ] 符合项目已有的代码风格
- [ ] 容易编写测试

### 输出审查报告

```
╔══════════════════════════════════════╗
║          代码审查报告                ║
╚══════════════════════════════════════╝

📄 审查文件：{文件路径}

1️⃣ 代码质量：{✅ 通过 / ⚠️ 有问题}
   {具体发现列表}

2️⃣ 安全性：{✅ 通过 / ⚠️ 有问题 / 🚨 严重}
   {具体发现列表}

3️⃣ 性能：{✅ 通过 / ⚠️ 有问题}
   {具体发现列表}

4️⃣ 可维护性：{✅ 通过 / ⚠️ 有问题}
   {具体发现列表}

📊 总评：{通过 / 需修改后通过 / 需重大修改}

🔧 建议修改：
1. [严重程度] {修改建议}
2. [严重程度] {修改建议}
...
```

### 后续操作
- 如果审查通过：建议使用 `/phase next` 推进到 P6
- 如果需修改：建议回到 P3/P4 进行修复，修复后重新审查
- 记录审查结果到 CLAUDE.md 的 `phase_history`
