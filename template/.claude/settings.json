{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "hooks": {
    "SessionStart": [
      {
        "matcher": "startup|resume|compact",
        "hooks": [
          {
            "type": "command",
            "command": "bash \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/session-start.sh",
            "timeout": 5
          }
        ]
      }
    ],
    "UserPromptSubmit": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "bash \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/user-prompt-submit.sh",
            "timeout": 3
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "bash \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/check-phase-write.sh",
            "statusMessage": "检查写入权限..."
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "bash \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/check-phase-test.sh",
            "statusMessage": "检查命令权限..."
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "echo '{\"hookSpecificOutput\":{\"hookEventName\":\"PostToolUse\",\"additionalContext\":\"SDLC 提醒：文件已修改。请用 Edit 更新 .claude/project-state.md：将修改的文件路径追加到 modified_files（如未列出），并更新 last_updated。这是强制要求，不可跳过。\"}}'",
            "timeout": 3,
            "async": true
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "agent",
            "prompt": "你是 SDLC 合规检查 agent。检查 Claude 是否可以停止工作。\n\n请执行以下步骤：\n1. 用 Read 工具读取 .claude/project-state.md\n2. 检查 current_phase 值\n3. 如果是 P0 → 可以停止\n4. 如果是 P1/P2 → 检查是否在等待用户确认（可以停止）\n5. 如果是 P3-P5（自动驱动阶段）→ 检查当前阶段工作是否完成、/review 是否执行并通过\n6. 如果是 P6 → 检查是否已输出交付摘要\n7. 检查 modified_files 列表与实际操作是否一致\n8. 检查 last_updated 是否为最新\n\n回复 JSON：{\"ok\": true} 如果可以停止，或 {\"ok\": false, \"reason\": \"具体原因\"} 如果应继续工作。",
            "timeout": 30
          }
        ]
      }
    ],
    "PreCompact": [
      {
        "hooks": [
          {
            "type": "agent",
            "prompt": "你是 SDLC 状态保存 agent。上下文即将被压缩，确保所有状态已保存。\n\n请执行以下步骤：\n1. 用 Read 工具读取 .claude/project-state.md\n2. 检查以下字段是否为最新值：current_phase, task_description, prd, modified_files, architecture_decisions, todo_items\n3. 特别检查 key_context 是否包含当前工作摘要（压缩后恢复需要）\n4. 如果有字段缺失或过时，用 Edit 工具更新 .claude/project-state.md\n\n回复 JSON：{\"ok\": true} 如果状态已完整保存，或 {\"ok\": false, \"reason\": \"需要更新的字段列表\"} 如果还需要保存。",
            "timeout": 30
          }
        ]
      }
    ],
    "SubagentStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "bash \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/subagent-start.sh",
            "timeout": 5,
            "statusMessage": "注入 SDLC 上下文..."
          }
        ]
      }
    ],
    "TaskCompleted": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "bash \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/task-completed.sh",
            "timeout": 3
          }
        ]
      }
    ],
    "SubagentStop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "bash \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/subagent-stop.sh",
            "timeout": 10,
            "statusMessage": "验证子 Agent 输出..."
          }
        ]
      }
    ],
    "PostToolUseFailure": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "bash \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/post-tool-failure.sh",
            "timeout": 5
          }
        ]
      }
    ],
    "PermissionRequest": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "bash \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/permission-request.sh",
            "timeout": 5,
            "statusMessage": "SDLC 权限决策..."
          }
        ]
      }
    ],
    "SessionEnd": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "bash \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/session-end.sh",
            "timeout": 10
          }
        ]
      }
    ]
  },
  "permissions": {
    "deny": [
      "Read(./.env)",
      "Read(./.env.*)",
      "Edit(./.env)",
      "Edit(./.env.*)",
      "Write(./.env)",
      "Write(./.env.*)"
    ],
    "allow": [
      "Bash(git status)",
      "Bash(git status *)",
      "Bash(git diff *)",
      "Bash(git log *)",
      "Bash(git branch)",
      "Bash(git branch --list *)",
      "Bash(git stash *)",
      "Bash(npm run lint *)",
      "Bash(npx eslint *)",
      "Bash(npx tsc *)",
      "Read(*)",
      "Glob(*)",
      "Grep(*)"
    ],
    "ask": [
      "Bash(rm -rf *)",
      "Bash(git push --force *)",
      "Bash(git reset --hard *)",
      "Bash(git branch -D *)"
    ],
    "defaultMode": "default"
  },
  "statusLine": {
    "type": "command",
    "command": "bash \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/statusline.sh",
    "padding": 1
  },
  "sandbox": {
    "enabled": true,
    "network": {
      "allowedDomains": ["github.com", "*.npmjs.org", "registry.npmmirror.com", "pypi.org"]
    }
  },
  "env": {
    "SDLC_PROJECT": "true",
    "SDLC_VERSION": "1.3.0"
  },
  "attribution": {
    "commit": "Co-Authored-By: Claude (SDLC Enforced) <noreply@anthropic.com>"
  },
  "fileSuggestion": {
    "type": "command",
    "command": "bash \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/file-suggestion.sh"
  },
  "spinnerVerbs": {
    "mode": "append",
    "verbs": ["审查中", "编码中", "测试中", "分析需求", "设计方案", "检查合规"]
  },
  "language": "zh-CN"
}
