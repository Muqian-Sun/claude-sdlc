{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "bash .claude/hooks/check-phase-write.sh"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "bash .claude/hooks/check-phase-test.sh"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "文件已修改。用 Edit 更新 CLAUDE.md：将文件路径追加到 modified_files（如未记录），更新 last_updated。必须执行，不可跳过。"
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "【SDLC 自检】读取 CLAUDE.md 确认 current_phase。检查：(1)本次操作匹配当前阶段？(2)符合 PRD？做了 PRD 外的事立即停止说明。(3)工具在允许列表内？(4)YAML 是否最新？不是则立即用 Edit 更新。(5)P2/P3 阶段：是否已用 Context7 MCP 查阅最新官方文档 + WebSearch 搜索最流行设计？未查阅则先执行调研再继续。【自动驱动】P1/P2 工作完成 → 展示产出物等用户确认，用户确认后自动审查推进；P3/P4/P5 工作完成 → 立即执行 /review 审查 → 通过则更新 current_phase 并开始下一阶段 → 未通过则自动修复重试（review_retry_count+1，≤3次，超过停下报告用户）；P6 审查通过 → 输出交付摘要报告。"
          }
        ]
      }
    ],
    "PreCompact": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "【压缩前保存】用 Read 读取 CLAUDE.md YAML 块，用 Edit 确保所有字段最新：current_phase、task_description、prd、modified_files、architecture_decisions、todo_items。特别更新 key_context 为当前工作摘要（在做什么、下一步什么）。不更新则状态丢失。"
          }
        ]
      }
    ]
  }
}
