# SDLC 开发规范

> 可用命令：`/phase`、`/status`、`/checkpoint`、`/review`、`/archive`

@.claude/project-state.md

## 启动指令

1. Read `.claude/project-state.md` 获取 `current_phase`
2. P1-P5：报告状态，继续工作
3. P0：等待用户任务

## 核心规则

- **严格按 PRD 开发**：每行代码对应 PRD 哪条需求？答不上来就不写。禁止增减 PRD 外内容
- **五阶段顺序执行**：P1需求+设计→P2编码→P3测试→P4审查→P5交付
- **只审查一次**：P4 是唯一正式审查关卡（代码+测试+集成+PRD追溯）。P1 靠用户确认推进，P2/P3/P5 完成后直接推进
- **自动驱动**：P1 用户确认 PRD 后，P2-P5 全自动。P4 审查未通过自动修复（最多3次）
- **任务自动识别**：用户说"实现/修复/重构..." → 自动进入 P1。旧任务完成后新请求 → 归档到 `completed_tasks` + 重置任务字段 + 新 P1。**`project_roadmap`/`completed_tasks`/`global_architecture` 永不重置**

## P1 需求澄清+调研+设计+原型

**P1 执行流程**：需求澄清+智能补充 → 技术调研+技术栈确认 → PRD确认 → 架构设计+方案对比确认 → 原型设计+设计确认

### 1. 需求澄清+智能补充（必须先执行）
用户说"开发XX"时，**充分对话+智能补充**：
- **智能补充维度**（从功能性角度）：
  - 核心功能：用户明确提出的功能有哪些？
  - 扩展功能：围绕核心功能的常见配套功能（如：登录→忘记密码/记住我）
  - 相关功能：提升用户体验的功能（如：加载状态、错误提示、操作反馈）
- **系统性提问**：使用 AskUserQuestion 获取功能范围、优先级、目标用户、技术约束、UI偏好
- **判断充分性**（满足所有条件才推进）：
  - ✅ 核心功能清晰（知道要做什么）
  - ✅ 扩展功能明确（知道哪些要做、哪些不做）
  - ✅ 优先级清楚（知道先做什么后做什么）
  - ✅ 关键约束已知（技术栈、性能、兼容性）
- 确认理解正确后记录到 project-state.md 的 `requirements_clarification`
- **【关键决策点1：需求确认】** - 向用户确认需求理解正确
- 禁止凭过时记忆假设需求，禁止跳过对话直接调研

### 2. 技术调研+技术栈确认（需求确认后）
- **先询问技术偏好**：现有技术栈？团队技能？项目约束？性能要求？
- Context7 MCP 查最新文档 + WebSearch 查最新方案（基于用户约束和场景）
- **涉及 UI 强制用 ui-ux-pro-max**：WebSearch "{框架} modern UI 2026"，从 67 风格+96 配色+57 字体选择
- **【关键决策点2：技术栈确认】** - 向用户确认技术选型

### 3. 编写 PRD 并确认
- 基于确认的需求和技术栈，编写精简 PRD（≤150行）
- 包含：需求表、技术栈、非功能需求、UI设计方向
- **【关键决策点3：PRD 确认】** - 用户确认后写入 project-state.md 的 `prd`，删除 `requirements_clarification`
- PRD 确认后锁定，才能进入下一步

### 4. 架构设计+方案对比（PRD 确认后）
- **提供 2-3 个可选方案**：列出不同架构方案，说明各自优缺点和适用场景
- 每个方案包含：模块划分、数据模型、接口定义、部署架构
- **【关键决策点4：架构确认】** - 用户选择方案后写入 `architecture_decisions`

### 5. 原型设计+设计确认（涉及 UI，架构确认后）
- 应用设计系统创建 HTML，Chrome 展示响应式（375/768/1440px）
- **【关键决策点5：设计确认】** - 用户确认后写入 `ui_design`（风格/配色/字体/组件库/prototype路径）
- **禁止 Bootstrap 3/4、jQuery UI、90年代风格**

**所有决策点确认完毕 → 推进 P2 自动驱动**

## 每次回复前自检

1. `current_phase` 是什么？
2. 要做的事对应 PRD 哪条？
3. 操作在当前阶段允许吗？
4. `.claude/project-state.md` 更新了吗？

有疑问 → Read `.claude/project-state.md`，不依赖记忆。

## 执行规范

**Bash 格式**：所有命令必须单行。禁止在 `2>&1`、`|`、`&&` 前换行。
**测试效率**：只跑一次（`tee /tmp/sdlc-test-output.txt`），Read 分析结果，批量修复后再跑一次。最多 3 次。
**输出精简**：报告/PRD/文档使用简洁格式（详见 09-memory-management.md）：
- 一句话原则：能用一句话不用两句
- 表格优先：结构化信息用表格
- 长度限制：PRD≤150行，审查≤15行，交付≤10行
- 记忆精简：completed_tasks 用精简格式，≥5个时自动归档
