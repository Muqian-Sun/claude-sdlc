# v1.12.0 变更日志

**发布日期**：2026-02-11

---

## 核心改进

### 1. PRD 文件分离

**问题**：PRD 内联在 `project-state.md` 导致上下文膨胀，压缩时难以保护

**解决方案**：
- PRD 写入独立文件 `.claude/prd.md`
- `project-state.md` 仅保存路径引用：`prd_file: ".claude/prd.md"`
- Compaction 时同时保护 `prd_file` 字段和 `.claude/prd.md` 文件

**优势**：
- 减少上下文大小（150行 PRD 不占用主状态空间）
- 易于管理和编辑
- Compaction 保护更可靠
- 符合最小必要原则

---

### 2. 文件大小优化（保证质量）

**目标**：减少文件体积 40%，提升加载和理解效率

**优化结果**：

| 文件 | 优化前 | 优化后 | 减少 | 方法 |
|------|--------|--------|------|------|
| 01-lifecycle-phases.md | 289行 | 122行 | **-57.8%** | 合并重复步骤、精简说明、保留核心流程 |
| CLAUDE.md | 85行 | 59行 | **-30.6%** | 浓缩 P1 流程、删除示例、保留决策点 |
| project-state.md | 69行 | 39行 | **-43.5%** | PRD 分离、精简注释、保留核心字段 |
| 09-memory-management.md | 318行 | 126行 | **-60.4%** | 删除冗余示例、表格化规则、浓缩说明 |

**优化原则**：
- 一句话原则：能用一句话不用两句
- 表格优先：结构化信息用表格
- 无装饰：删除 ASCII 边框、重复标题
- 无冗余：信息只在一处出现
- 保留核心：所有关键流程和规则完整保留

**质量保证**：
- ✅ 所有核心功能点保留
- ✅ 5 个决策点机制完整
- ✅ 工具限制和执行规范清晰
- ✅ Compaction 保护规则完整

---

## 修改文件

### 核心配置
- `template/CLAUDE.md` - 主入口精简（-30.6%）
- `template/.claude/project-state.md` - 状态模板精简，PRD 分离（-43.5%）

### 规则文档
- `template/.claude/rules/01-lifecycle-phases.md` - P1 流程精简（-57.8%）
- `template/.claude/rules/09-memory-management.md` - 记忆管理重构（-60.4%）

### 元数据
- `package.json` - 版本号 1.11.0 → 1.12.0

---

## 向后兼容性

✅ **完全兼容 v1.11.0**

- 升级自动：运行 `npx claude-sdlc upgrade` 即可
- 现有 PRD：保留内联格式，新项目使用文件格式
- 配置保护：用户自定义配置不受影响

---

## 安装与升级

### 新项目
```bash
npx claude-sdlc init
```

### 升级现有项目
```bash
npx claude-sdlc upgrade
```

---

## 完整功能

v1.12.0 包含 v1.11.0 的所有功能：

**P1 强化沟通机制**：
- 5 个决策点确认（需求、技术栈、PRD、架构、设计）
- 智能需求补充（核心/扩展/相关功能）
- 架构方案对比（2-3 个方案 + 优缺点）
- 技术调研（Context7 + WebSearch）
- UI 设计系统（ui-ux-pro-max skill）

**PRD 优化**：
- ✅ PRD 独立文件存储
- ✅ 精简格式（≤150 行）
- ✅ Compaction 保护

**记忆管理**：
- ✅ 自动归档（≥5 个 completed_tasks）
- ✅ 精简记录（prd_summary ≤50 字）
- ✅ 文件优化（减少 40-60% 体积）

---

## 下一步

- [ ] 测试 PRD 文件格式在真实项目中的效果
- [ ] 收集文件大小优化的用户反馈
- [ ] 考虑支持 PRD 模板库
