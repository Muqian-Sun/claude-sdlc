# P1 阶段流程优化说明

## 修改概述

将 P1 阶段从"调研→架构设计→原型→PRD 确认"改为**"需求澄清→调研→PRD 确认→架构设计→原型设计"**，增加多轮对话环节，确保充分理解需求后再开发。

---

## 新流程详解

### 旧流程（v1.8.0 及之前）
```
P1 开始 → 调研 → 架构设计 → 原型 → PRD 确认 → P2
         ↑ 可能基于假设或过时记忆
```

### 新流程（当前版本）
```
P1 开始
  ↓
1. 需求澄清（新增）
   - 多轮对话获取信息（AskUserQuestion）
   - 确认功能范围、优先级、技术约束、UI 偏好
   - 记录到 requirements_clarification
  ↓
2. 技术调研
   - Context7 MCP + WebSearch（基于澄清的需求）
   - UI 调研（如涉及界面）
  ↓
3. 编写 PRD 并确认 ✓ 第一个检查点
   - 基于需求澄清和调研结果
   - 用户确认后写入 prd 字段
   - 删除 requirements_clarification（已转化为 PRD）
  ↓
4. 架构设计
   - 基于已确认的 PRD
   - 模块划分、数据模型、接口定义
  ↓
5. 原型设计（如涉及 UI）
   - 基于 PRD 和架构设计
   - Chrome 展示响应式效果
   - 用户确认 ✓ 第二个检查点
  ↓
P2 自动驱动
```

---

## 核心改进

| 方面 | 改进内容 |
|------|---------|
| **需求理解** | 增加多轮对话环节，系统性获取信息，避免假设 |
| **PRD 质量** | PRD 基于充分的需求澄清和调研，更准确 |
| **用户参与** | 两个检查点：PRD 确认 + 设计确认，分阶段确认降低风险 |
| **架构合理性** | 架构基于已确认的 PRD，不会偏离需求 |
| **原型准确性** | 原型基于 PRD 和架构，不会出现设计与需求不符 |

---

## 需求澄清要点

### 必须提问的领域
1. **功能范围**：核心功能？优先级？必须 vs 可选？
2. **目标用户**：谁用？使用场景？
3. **技术约束**：技术栈偏好？平台兼容性？
4. **非功能需求**：性能？安全？可访问性？
5. **UI/UX**（如涉及）：风格？配色？参考案例？
6. **数据和集成**：数据来源？对接系统？

### 结束对话的标准
- ✅ 核心功能清晰
- ✅ 优先级明确
- ✅ 关键约束已知
- ✅ UI 方向确定（如涉及界面）

---

## 修改的文件

| 文件 | 修改内容 |
|------|---------|
| `01-lifecycle-phases.md` | 重构 P1 流程，增加需求澄清环节，调整步骤顺序 |
| `CLAUDE.md` | 更新 P1 说明，强调需求澄清和两个检查点 |
| `project-state.md` | 增加 `requirements_clarification` 临时字段 |
| `README.md` | 更新工作流程图，说明两个检查点 |

---

## 使用示例

### 场景：用户说"帮我开发一个任务管理系统"

**旧流程**：
```
Claude: "我先调研一下任务管理系统的最佳实践..."
         ↑ 可能假设用户需要看板、甘特图等功能
```

**新流程**：
```
Claude: "在开始前，我需要了解一些信息：

1. 核心功能优先级：
   - 任务的创建、编辑、删除
   - 任务分配给团队成员
   - 任务状态跟踪（待办/进行中/完成）
   - 任务优先级和截止日期
   - 哪些是必须的，哪些是可选的？

2. 目标用户：
   - 个人使用还是团队协作？
   - 团队规模大约多少人？

3. 技术约束：
   - 需要支持的平台（Web/移动端/桌面）？
   - 有技术栈偏好吗（React/Vue/其他）？

4. UI 偏好：
   - 期望的风格（简洁/专业/创意）？
   - 有参考的产品吗（Trello/Asana/其他）？"

用户回答后 → 调研 → PRD 确认 → 架构设计 → 原型
```

---

## 禁止行为

- ❌ 跳过需求澄清直接调研和写 PRD
- ❌ 凭对话记忆假设用户需求
- ❌ 只问一两个问题就开始调研
- ❌ PRD 未确认就开始架构设计
- ❌ 架构未完成就开始原型设计

---

## 检查清单

### P1.1 需求澄清完成检查
- [ ] 已使用 AskUserQuestion 系统性提问
- [ ] 核心功能和优先级明确
- [ ] 技术约束和非功能需求已知
- [ ] UI 方向确定（如涉及界面）
- [ ] 已记录到 requirements_clarification

### P1.3 PRD 确认检查
- [ ] PRD 基于需求澄清和调研编写
- [ ] 包含需求表、技术栈、非功能需求
- [ ] 用户已确认 PRD
- [ ] 已写入 prd 字段
- [ ] 已删除 requirements_clarification

### P1.5 原型确认检查（如涉及 UI）
- [ ] 原型基于 PRD 和架构设计
- [ ] 在 Chrome 中展示并测试响应式
- [ ] 用户已确认设计系统
- [ ] 已写入 ui_design 字段

---

## 效果预期

1. **需求准确性提升**：通过多轮对话，减少因假设导致的返工
2. **PRD 质量提升**：基于充分信息编写，更贴合实际需求
3. **开发效率提升**：需求明确后开发更顺畅，减少中途修改
4. **用户满意度提升**：两个检查点让用户更有掌控感

---

## 向后兼容

- 旧版本项目的 project-state.md 可继续使用
- requirements_clarification 字段为可选，不影响旧流程
- 已有的 PRD 不受影响

---

## 下一步

- [ ] 更新 hooks 脚本，在 P1 开始时提醒需求澄清
- [ ] 更新 skills/phase/SKILL.md，增加 P1 子阶段状态显示
- [ ] 创建需求澄清模板（AskUserQuestion 问题清单）
